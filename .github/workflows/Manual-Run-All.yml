name: Manual Run All Workflows

on:
  workflow_dispatch:
    inputs:
      workflows:
        description: "Which workflows to run"
        required: true
        type: choice
        options:
          - all
          - assessments-only
          - fixes-only
          - pr-compiler-only
      dry_run:
        description: "Dry run (no commits/PRs)"
        required: false
        default: false
        type: boolean

permissions:
  contents: write
  pull-requests: write
  actions: write

jobs:
  dispatch-workflows:
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch Comprehensive Assessment
        if: inputs.workflows == 'all' || inputs.workflows == 'assessments-only'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'Jules-Comprehensive-Assessment.yml',
              ref: 'main'
            });
            console.log('Dispatched Comprehensive Assessment');

      - name: Wait for Assessment
        if: inputs.workflows == 'all' || inputs.workflows == 'assessments-only'
        run: sleep 10

      - name: Dispatch Documentation Auditor
        if: inputs.workflows == 'all' || inputs.workflows == 'assessments-only'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'Jules-Documentation-Auditor.yml',
              ref: 'main'
            });
            console.log('Dispatched Documentation Auditor');

      - name: Wait for Documentation Auditor
        if: inputs.workflows == 'all'
        run: sleep 10

      - name: Dispatch PR Compiler
        if: inputs.workflows == 'all' || inputs.workflows == 'fixes-only' || inputs.workflows == 'pr-compiler-only'
        uses: actions/github-script@v7
        with:
          script: |
            const dry_run = '${{ inputs.dry_run }}' === 'true';
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'Jules-PR-Compiler.yml',
              ref: 'main',
              inputs: { dry_run: dry_run.toString() }
            });
            console.log('Dispatched PR Compiler');

      - name: Summary
        run: |
          echo "## Workflows Dispatched" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Mode: ${{ inputs.workflows }}" >> $GITHUB_STEP_SUMMARY
          echo "Dry Run: ${{ inputs.dry_run }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Check the Actions tab to monitor progress of individual workflows." >> $GITHUB_STEP_SUMMARY
